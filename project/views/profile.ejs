<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/private/css/framework.css">
    <link rel="stylesheet" href="/private/css/boards.css">
    <link rel="stylesheet" href="/private/css/profile.css">
    <link rel="shortcut icon" href="/private/images/logo.png" type="image/x-icon">
    <title><%= user["name"].split(' ')[0] %>'s Profile | ATC</title>
</head>
<body>
    <span id="user-id" style="display: none;"><%= user["id"] %></span>
    <div id="nav"></div>
    <%_ if(user["id"] == id) { %>
        <h1 class="text-center m20 fs30">Your Account</h1>
    <%_ } %>
    <section id="profile" class="board p20 w85">
        <div class="wrapper-top">
            <div class="profile-container">
                <img class="profile-img" src="<%= user["pfp"] %>" alt="Profile Picture">
                <div class="user-details m10">
                    <h1 class="text-center fs20 m-atuo overflow-scroll"><%= user["name"] %></h1>
                    <p class="text-center fs15 m10 overflow-scroll"><%= user["username"] %></p>
                    <%_ if(user["id"] == id) { %>
                        <button class="text-center fs15"><a href="/logout">Log out</a></button>
                    <%_ } %>
                </div>
                <div class="played-details" id="last">
                    <h1 class="fs20">last Luton</h1>
                </div>
                <div class="played-details" id="best">
                    <h1 class="fs20">best Heathrow</h1>
                </div>  

            </div>
            <div class="profile-container" id="user-history" style="width: 100%; height: 80%; align-content: baseline;">
                <h1 class="m10 fs20 text-center"><%= user["name"].split(' ')[0] %>'s history</h1>
            </div>
        </div>
    </section>
    <script src="https://code.jquery.com/jquery-3.6.1.js" integrity="sha256-3zlB5s2uwoUzrXK3BT7AX3FyvojsraNFxCc2vC/7pNI=" crossorigin="anonymous"></script>
    <script>
        $('#nav').load('/views/navbar.ejs')

        const id_types = ['level', 'date', 'score']

        $.get(`../db/history/${$('#user-id').text()}.json`, json => {
            const entries = json.entries

            $('<div>', { class: 'sep' }).appendTo('#user-history')
            $('<table>', {
                id: `entries`
            }).appendTo(`#user-history`)

            if(entries.length > 0) {
            
                $('<tr>', {
                    class: "fs20 m20", // framework
                    id: 'table-header'
                }).appendTo(`#entries`) // add to correct table
                
                // add the headers of the table to table
                for(let i = 0; i < id_types.length; i++) {
                    $('<th>', { // new row entry
                        // making text capitalised using character seperation
                        text: `${id_types[i].charAt(0).toUpperCase() + id_types[i].slice(1)}`,
                        class: "fs20 m20"
                    }).appendTo('#table-header') // add it to the table heading
                }
                // adding table entries from JSON file
                for(let x = 0; x < entries.length; x++) {
                    // same process as before, add new row 
                    $('<tr>',{
                        id: `entry${x + 1}`, // this time assign row id
                    }).appendTo(`#entries`)

                    let obj = Object.values(entries[x]) // convert text to object

                    for(let value = 0; value < obj.length - 1; value++) { // cycle through each key in object and get val
                        $('<th>',{ // new row part
                            class: "color-black fs20 m20",
                            id: `${id_types[value]}-${x + 1}`, // for future updates (TABLE FILTERS)
                        }).appendTo(`#entry${x + 1}`) // x is 0 based, add 1
                        if(id_types[value] == 'name' || id_types[value] == 'level') {
                            $('<a>', {
                                text: obj[value],
                            }).appendTo(`#${id_types[value]}-${x + 1}`)
                        } else {
                            $(`#${id_types[value]}-${x + 1}`).text(obj[value]).css('color', 'white')
                        }
                    }
                }
            } else {
                $('<p>', { // new paragraph
                    text: 'Nothing to see here :(', // User feedback
                    class: 'text-center fs15 m-auto'
                }).appendTo(`#user-history`)
            }
        })
    </script>
</body>
</html>